import{slideDown,slideUp,fadeIn,fadeOut,scrollIntoView}from"./animation";import{getHash,updateURL}from"./hash";import{validID,getToggleState,getIndexById,getElements,hasLiveBreakpoint,isLive}from"./helpers";export class EasyTabAccordion{constructor(t){if(this.dev=!1,this._class={enabled:"easy-tab-accordion-enabled",active:"active"},this._attr={container:"data-eta",trigger:"data-eta-trigger",receiver:"data-eta-receiver",hash:"data-eta-hash",hashScroll:"data-eta-hash-scroll",animation:"data-eta-animation"},this.options={el:document.querySelector(`[${this._attr.container}]`),trigger:`[${this._attr.trigger}]`,triggerAttr:this._attr.trigger,receiver:`[${this._attr.receiver}]`,receiverAttr:this._attr.receiver,activeClass:this._class.active,animation:"slide",duration:600,hash:!1,hashScroll:!1,liveBreakpoint:[],activeSection:0,allowCollapseAll:!1,onBeforeOpen:(t,i)=>{},onBeforeClose:(t,i)=>{},onAfterOpen:(t,i)=>{},onAfterClose:(t,i)=>{},onAfterDestroy:(t,i)=>{},...t},!this.options.el)return void console.warn("ETA Error, target not found!");this.wrapper=this.options.el,this.current_id="",this.previous_id="",this.type="",this.hasInitialized=!1,this.enabled=!hasLiveBreakpoint(this)||isLive(this),this.count=this.wrapper.querySelectorAll(this.options.trigger).length,this.options.hash=!0===this.wrapper.hasAttribute(this._attr.hash)||this.options.hash,this.options.hashScroll=!0===this.wrapper.hasAttribute(this._attr.hashScroll)||this.options.hashScroll;const i=this.wrapper.getAttribute(this._attr.animation);if(this.options.animation=null!==i?i:this.options.animation,this.enabled&&!this.hasInitialized&&this.init(),!this.enabled&&this.hasInitialized&&this.destroy(),this.enabled){const t=getHash(),i=t.hash,e=t.id;if(this.options.hash&&i.length&&this.receiver_ids.filter((t=>t.id===e)).length)this.toggle(e,"hash");else{this.options.activeSection>=0&&this.options.activeSection<this.count&&this.toggle(this.receiver_ids[this.options.activeSection].id,"auto")}}return window.addEventListener("resize",(t=>this.resizeWatcher(t))),window.addEventListener("load",(t=>this.resizeWatcher(t))),{toggle:t=>this.toggle(t),toggleByIndex:t=>this.toggle(this.receiver_ids[t].id),destroy:()=>this.destroy()}}log(){this.dev&&console.log(...arguments)}assignTriggerElements(){document.querySelectorAll('a[href^="#"]').forEach((t=>{const i=t.getAttribute("href"),e="#"===i[0]?i.slice(1):getHash(i).id;e&&this.receiver_ids.forEach((i=>{i.id===e&&t.addEventListener("click",(t=>{t.preventDefault(),this.toggle(e,"manual"),scrollIntoView()}))}))}))}resizeWatcher(t){hasLiveBreakpoint(this)&&isLive(this)!==this.enabled&&(this.enabled=isLive(this),this.enabled?(this.init(),this.toggle(this.current_id||this.receiver_ids[0].id,"auto",!0)):this.destroy())}manualTriggerFunction(t){t.preventDefault(),t.stopPropagation();const i=t.target.getAttribute(this.options.triggerAttr)||t.target.closest(this.options.trigger).getAttribute(this.options.triggerAttr);this.log("manualTriggerFunction",i),this.toggle(i,"manual")}init(){this.log("Before init",this),this.hasInitialized=!0,this.enabled=!0,this.wrapper.classList.add(this._class.enabled),this.wrapper.querySelectorAll(this.options.trigger).forEach((t=>{t.addEventListener("click",(t=>this.manualTriggerFunction(t)),!0)})),this.receiver_ids=[],this.wrapper.querySelectorAll(this.options.receiver).forEach((t=>{const i=t.getAttribute(this.options.receiverAttr);this.receiver_ids.push({id:i,el:t,active:!1}),"fade"===this.options.animation&&(t.style.position="absolute"!==getComputedStyle(t).position?"absolute":"",t.style.inset="0",t.style.transition=`opacity ${this.options.duration}ms ease`,t.style.overflow="hidden",t.parentElement.style.position="relative"!==getComputedStyle(t).position?"relative":"",t.parentElement.style.transition=`height ${this.options.duration}ms ease`)})),this.assignTriggerElements(),this.log("After init",this)}destroy(){this.enabled=!1,this.wrapper.classList.remove(this._class.enabled),this.wrapper.querySelectorAll(this.options.trigger).forEach((t=>{t.removeEventListener("click",this.manualTriggerFunction,!0)})),this.receiver_ids=[],"fade"===this.options.animation&&this.wrapper.querySelectorAll(this.options.receiver).forEach((t=>{t.style.opacity="",t.style.visibility="",t.style.position="",t.style.inset="",t.style.transition="",t.parentElement.style.height="",t.parentElement.style.position="",t.parentElement.style.transition=""})),"slide"===this.options.animation&&this.wrapper.querySelectorAll(this.options.receiver).forEach((t=>{slideDown(t,this.options.duration)})),this.options.onAfterDestroy(this)}openPanel(t=this.current_id){if(!validID(this,t))return;(()=>{this.receiver_ids[getIndexById(this,t)].active=!0,this.options.hash&&"manual"===this.type&&updateURL(t),this.options.onBeforeOpen(this)})();const i=t=>{"hash"===this.type&&this.options.hashScroll&&window.addEventListener("load",(()=>setTimeout((()=>scrollIntoView()),100))),this.options.onAfterOpen(this,t)},{current:e}=getElements(this,t);switch(this.options.animation){case"slide":e.forEach((t=>slideDown(t,this.options.duration,(()=>i(t)))));break;case"fade":e.forEach((t=>fadeIn(t,this.options.duration,(()=>i(t)))))}e.forEach((t=>t.classList.add(this._class.active))),this.receiver_ids.filter((i=>i.id!==t)).forEach((t=>this.closePanel(t.id)))}closePanel(t=this.current_id){if(!validID(this,t))return;this.options.onBeforeClose(this),this.receiver_ids[getIndexById(this,t)].active=!1;const i=t=>{this.options.onAfterClose(this,t)},{current:e}=getElements(this,t);switch(this.options.animation){case"slide":e.forEach((t=>slideUp(t,this.options.duration,(()=>i(t)))));break;case"fade":e.forEach((t=>fadeOut(t,this.options.duration,(()=>i(t)))))}e.forEach((t=>{t.classList.remove(this._class.active)}))}toggle(t,i="undefined",e=!1){if(this.log("[toggle] > start",arguments,this),!validID(this,t))return void this.log(`[toggle] > exit, id[${t}] not found`);const s=getToggleState(this,t);0!==s&&(this.log("Before toggle",t),this.type=i,this.previous_id=this.current_id?this.current_id:this.receiver_ids[0].id,1===s?(this.current_id=t,this.openPanel(this.current_id)):this.closePanel(this.current_id))}}document.querySelectorAll("[data-eta]").forEach((t=>new EasyTabAccordion({el:t})));