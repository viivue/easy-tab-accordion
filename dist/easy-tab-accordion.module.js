/**!
 * Easy Tab & Accordion v1.0.1
 * https://github.com/viivue/easy-tab-accordion
 * MIT license - 2022
 */
import{removeTransition,setTransition}from"./animation";export class EasyTabAccordion{constructor(t){if(this.dev=!1,this._class={enabled:"easy-tab-accordion-enabled",active:"active"},this._attr={container:"data-eta",trigger:"data-eta-trigger",receiver:"data-eta-receiver",hash:"data-eta-hash",hashScroll:"data-eta-hash-scroll",animation:"data-eta-animation"},this.options={el:document.querySelector(`[${this._attr.container}]`),trigger:`[${this._attr.trigger}]`,triggerAttr:this._attr.trigger,receiver:`[${this._attr.receiver}]`,receiverAttr:this._attr.receiver,activeClass:this._class.active,animation:"slide",duration:600,hash:!1,hashScroll:!1,liveBreakpoint:[],activeSection:0,allowCollapseAll:!1,onBeforeOpen:(t,i)=>{},onBeforeClose:(t,i)=>{},onAfterOpen:(t,i)=>{},onAfterClose:(t,i)=>{},onAfterDestroy:(t,i)=>{},...t},!this.options.el)return void console.warn("ETA Error, target not found!");this.wrapper=this.options.el,this.current_id="",this.previous_id="",this.type="",this.hasInitialized=!1,this.enabled=!this.hasLiveBreakpoint()||this.isLive(),this.count=this.wrapper.querySelectorAll(this.options.trigger).length,this.options.hash=!0===this.wrapper.hasAttribute(this._attr.hash)||this.options.hash,this.options.hashScroll=!0===this.wrapper.hasAttribute(this._attr.hashScroll)||this.options.hashScroll;const i=this.wrapper.getAttribute(this._attr.animation);if(this.options.animation=null!==i?i:this.options.animation,this.enabled&&!this.hasInitialized&&this.init(),!this.enabled&&this.hasInitialized&&this.destroy(),this.enabled){const t=this.getHash(),i=t.hash,e=t.id;if(this.options.hash&&i.length&&this.receiver_ids.filter((t=>t.id===e)).length)this.toggle(e,"hash");else{this.options.activeSection>=0&&this.options.activeSection<this.count&&this.toggle(this.receiver_ids[this.options.activeSection].id,"auto")}}return window.addEventListener("resize",(t=>this.resizeWatcher(t))),window.addEventListener("load",(t=>this.resizeWatcher(t))),{toggle:t=>this.toggle(t),toggleByIndex:t=>this.toggle(this.receiver_ids[t].id),destroy:()=>this.destroy()}}log(){this.dev&&console.log(...arguments)}getHash(t=document.location){const i=new URL(t),e=i.hash.indexOf("?"),s=e>-1?i.hash.slice(0,e):i.hash;return{data:i,hash:s,id:s.slice(1)}}scrollIntoView(){this.wrapper.scrollIntoView({behavior:"smooth"})}assignTriggerElements(){document.querySelectorAll('a[href^="#"]').forEach((t=>{const i=t.getAttribute("href"),e="#"===i[0]?i.slice(1):this.getHash(i).id;e&&this.receiver_ids.forEach((i=>{i.id===e&&t.addEventListener("click",(t=>{t.preventDefault(),this.toggle(e,"manual"),this.scrollIntoView()}))}))}))}hasLiveBreakpoint(){return 2===this.options.liveBreakpoint.length}isLive(){return window.innerWidth<=this.options.liveBreakpoint[0]&&window.innerWidth>=this.options.liveBreakpoint[1]&&this.hasLiveBreakpoint()}resizeWatcher(t){this.hasLiveBreakpoint()&&this.isLive()!==this.enabled&&(this.enabled=this.isLive(),this.enabled?(this.init(),this.toggle(this.current_id||this.receiver_ids[0].id,"auto",!0)):this.destroy())}manualTriggerFunction(t){t.preventDefault(),t.stopPropagation();const i=t.target.getAttribute(this.options.triggerAttr)||t.target.closest(this.options.trigger).getAttribute(this.options.triggerAttr);this.log("manualTriggerFunction",i),this.toggle(i,"manual")}init(){this.log("Before init",this),this.hasInitialized=!0,this.enabled=!0,this.wrapper.classList.add(this._class.enabled),this.wrapper.querySelectorAll(this.options.trigger).forEach((t=>{t.addEventListener("click",(t=>this.manualTriggerFunction(t)),!0)})),this.receiver_ids=[],this.wrapper.querySelectorAll(this.options.receiver).forEach((t=>{const i=t.getAttribute(this.options.receiverAttr);this.receiver_ids.push({id:i,el:t,active:!1}),"fade"===this.options.animation&&(t.style.position="absolute"!==getComputedStyle(t).position?"absolute":"",t.style.inset="0",t.style.transition=`opacity ${this.options.duration}ms ease`,t.style.overflow="hidden",t.parentElement.style.position="relative"!==getComputedStyle(t).position?"relative":"",t.parentElement.style.transition=`height ${this.options.duration}ms ease`)})),this.assignTriggerElements(),this.log("After init",this)}destroy(){this.enabled=!1,this.wrapper.classList.remove(this._class.enabled),this.wrapper.querySelectorAll(this.options.trigger).forEach((t=>{t.removeEventListener("click",this.manualTriggerFunction,!0)})),this.receiver_ids=[],"fade"===this.options.animation&&this.wrapper.querySelectorAll(this.options.receiver).forEach((t=>{t.style.opacity="",t.style.visibility="",t.style.position="",t.style.inset="",t.style.transition="",t.parentElement.style.height="",t.parentElement.style.position="",t.parentElement.style.transition=""})),"slide"===this.options.animation&&this.wrapper.querySelectorAll(this.options.receiver).forEach((t=>{this.slideDown(t,this.options.duration)})),this.options.onAfterDestroy(this)}openPanel(t=this.current_id){if(!this.validID(t))return;(()=>{this.receiver_ids[this.getIndexById(t)].active=!0,this.updateURL(t),this.options.onBeforeOpen(this)})();const i=t=>{"hash"===this.type&&this.options.hashScroll&&window.addEventListener("load",(()=>setTimeout((()=>this.scrollIntoView()),100))),this.options.onAfterOpen(this,t)},{current:e}=this.getElements(t);switch(this.options.animation){case"slide":e.forEach((t=>this.slideDown(t,this.options.duration,(()=>i(t)))));break;case"fade":e.forEach((t=>this.fadeIn(t,this.options.duration,(()=>i(t)))))}e.forEach((t=>t.classList.add(this._class.active))),this.receiver_ids.filter((i=>i.id!==t)).forEach((t=>this.closePanel(t.id)))}closePanel(t=this.current_id){if(!this.validID(t))return;this.options.onBeforeClose(this),this.receiver_ids[this.getIndexById(t)].active=!1;const i=t=>{this.options.onAfterClose(this,t)},{current:e}=this.getElements(t);switch(this.options.animation){case"slide":e.forEach((t=>this.slideUp(t,this.options.duration,(()=>i(t)))));break;case"fade":e.forEach((t=>this.fadeOut(t,this.options.duration,(()=>i(t)))))}e.forEach((t=>{t.classList.remove(this._class.active)}))}getToggleState(t){if(!this.validID(t))return;const i=this.receiver_ids[this.getIndexById(t)].active;return i&&this.options.allowCollapseAll?-1:i&&!this.options.allowCollapseAll?0:!i&&this.options.allowCollapseAll?1:i||this.options.allowCollapseAll?i?1:-1:1}validID(t){return!!this.receiver_ids.filter((i=>i.id===t)).length}toggle(t,i="undefined",e=!1){if(this.log("[toggle] > start",arguments,this),!this.validID(t))return void this.log(`[toggle] > exit, id[${t}] not found`);const s=this.getToggleState(t);0!==s&&(this.log("Before toggle",t),this.type=i,this.previous_id=this.current_id?this.current_id:this.receiver_ids[0].id,1===s?(this.current_id=t,this.openPanel(this.current_id)):this.closePanel(this.current_id))}updateURL(t,i=this.type){const e=document.location.origin+document.location.pathname;this.options.hash&&"manual"===i&&(document.location=e+"#"+t)}getElements(t,i=!0){const e=i?this.options.receiver:this.options.trigger,s=i?this.options.receiverAttr:this.options.triggerAttr;return{previous:this.wrapper.querySelectorAll(`${e}:not([${s}="${t}"])`),current:this.wrapper.querySelectorAll(`[${s}="${t}"]`)}}getIndexById(t){return this.receiver_ids.findIndex((i=>i.id===t))}slideUp(t,i=500,e){this.log("[animate] slide up",arguments),t.style.boxSizing="border-box",t.style.height=t.scrollHeight+"px",setTransition(t,i),t.style.height="0px",setTimeout((()=>{t.style.display="none",t.style.removeProperty("height"),removeTransition(t),"function"==typeof e&&e()}),i)}slideDown(t,i=500,e){this.log("[animate] slide down"),t.style.boxSizing="border-box",t.style.height="0px",t.style.display="block",setTransition(t,i),t.style.height=t.scrollHeight+"px",setTimeout((()=>{removeTransition(t),"function"==typeof e&&e()}),i)}fadeOut(t,i=500,e){t.style.opacity="0",t.style.visibility="hidden",setTimeout((()=>{"function"==typeof e&&e()}),i)}fadeIn(t,i=500,e){t.style.bottom="",t.style.opacity="1",t.style.visibility="visible",t.parentElement.style.height=`${t.offsetHeight}px`,t.style.bottom="0",setTimeout((()=>{"function"==typeof e&&e()}),i)}}document.querySelectorAll("[data-eta]").forEach((t=>new EasyTabAccordion({el:t})));